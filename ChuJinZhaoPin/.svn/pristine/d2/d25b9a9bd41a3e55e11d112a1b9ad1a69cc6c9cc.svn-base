//
//  PublishPositionTableViewCell.m
//  ChuJinZhaoPin
//
//  Created by eims on 2018/11/13.
//  Copyright © 2018 Monster. All rights reserved.
//

#import "PublishPositionTableViewCell.h"

@implementation PublishPositionTableViewCell

-(instancetype)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier{
    self = [super initWithStyle:style reuseIdentifier:reuseIdentifier];
    if (self) {
        self.selectionStyle = UITableViewCellSelectionStyleNone;
        [self initUI];
    }
    return self;
}
-(void)initUI{
    
    self.backgroundColor = COLOR_BG;
    
    UIView *bgV = [UIView new];
    bgV.backgroundColor = RGBCOLOR(255, 255, 255);
    [self.contentView addSubview:bgV];
    [bgV mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.top.right.mas_offset(0);
        make.height.mas_equalTo(Size(262/2));
    }];
    
    _jobNameLab = [UILabel ym_labelWithFrame:CGRectZero font:[UIFont systemFontOfSize:Size(14)] textColor:COLOR_RGB_51];
    [bgV addSubview:_jobNameLab];
    [_jobNameLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_offset(Size(14));
        make.top.mas_offset(Size(20));
    }];
    
    
    _moneyLab = [UILabel ym_labelWithFrame:CGRectZero font:[UIFont systemFontOfSize:Size(14)] textColor:RGBCOLOR(255, 101, 64)];
    [bgV addSubview:_moneyLab];
    [_moneyLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(_jobNameLab);
        make.right.mas_offset(-Size(15));
    }];
    
    
    _dateLab = [UILabel ym_labelWithFrame:CGRectZero font:[UIFont systemFontOfSize:Size(11)] textColor:RGBCOLOR(102, 102, 102)];
    [bgV addSubview:_dateLab];
    [_dateLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.mas_offset(-Size(15));
        make.top.equalTo(_moneyLab.mas_bottom).mas_offset(Size(20));
    }];
    
    
    
    _logoImgV = [UIImageView new];
    _logoImgV.contentMode = UIViewContentModeScaleAspectFit;
    [bgV addSubview:_logoImgV];
    [_logoImgV mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_offset(Size(15));
        make.width.mas_equalTo(Size(130/2));
        make.height.mas_equalTo(Size(130/2));
        make.bottom.mas_offset(-Size(15));
    }];
    
    
    _companyLab = [UILabel ym_labelWithFrame:CGRectZero font:[UIFont systemFontOfSize:Size(13)] textColor:COLOR_RGB_51];
    [bgV addSubview:_companyLab];
    [_companyLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(_logoImgV.mas_right).mas_offset(Size(10));
        make.top.equalTo(_logoImgV.mas_top);
    }];
    
    
    UIImageView *tempImgV;
    for (int i = 0; i<5; i++) {
        UIImageView *imgV = [[UIImageView alloc]initWithImage:[UIImage imageNamed:@"职位详情-收藏01"]];
        [bgV addSubview:imgV];
        [imgV mas_makeConstraints:^(MASConstraintMaker *make) {
            if (!tempImgV) {
                make.left.equalTo(_logoImgV.mas_right).mas_offset(Size(10));
                make.bottom.equalTo(_logoImgV.mas_bottom);
            }else{
                make.left.equalTo(tempImgV.mas_right).mas_offset(Size(5));
                make.top.equalTo(tempImgV);
            }
            make.width.height.mas_equalTo(Size(23/2));
            
        }];
        tempImgV = imgV;
        [self.starImgVArr addObject:imgV];
    }
    
    
    
    _scoreLab = [UILabel ym_labelWithFrame:CGRectZero font:[UIFont systemFontOfSize:Size(11)] textColor:COLOR_RGB_51];
    [bgV addSubview:_scoreLab];
    [_scoreLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.starImgVArr.lastObject.mas_right).mas_offset(Size(8));
        make.centerY.equalTo(self.starImgVArr.lastObject);
    }];
    //_scoreLab.text = @"4.5分";
    
    NSArray *arr = @[@"",@"",@""];
    UILabel *tempLab;
    for (int i=0; i<arr.count; i++) {
        UILabel *lab = [UILabel ym_labelWithFrame:CGRectZero font:[UIFont systemFontOfSize:Size(10)] textColor:COLOR_RGB_153];
        lab.backgroundColor = RGBCOLOR(249, 250, 253);
        lab.layer.cornerRadius = Size(5);
        lab.textAlignment = NSTextAlignmentCenter;
        lab.text = arr[i];
        [bgV addSubview:lab];
        //CGFloat w = [arr[i] ym_getStringWidthfont:[UIFont systemFontOfSize:Size(10)]];
        [lab mas_makeConstraints:^(MASConstraintMaker *make) {
            if (!tempLab) {
                make.left.equalTo(_logoImgV.mas_right).mas_offset(Size(10));
                make.centerY.equalTo(_logoImgV);
                
            }else{
                make.left.equalTo(tempLab.mas_right).mas_offset(Size(7));
                make.top.equalTo(tempLab);
            }
            make.height.mas_equalTo(Size(35/2));
            //make.width.mas_equalTo(w+Size(10));
        }];
        
        tempLab = lab;
        [self.tagLabArr addObject:lab];
    }
    
    _btnView = [UIView new];
    _btnView.backgroundColor = RGBCOLOR(255, 255, 255);
    _btnView.layer.borderColor = COLOR_RGB_line.CGColor;
    _btnView.layer.borderWidth = 0.4;
    [self.contentView addSubview:_btnView];
    [_btnView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.right.mas_offset(0);
        make.top.equalTo(bgV.mas_bottom);
        make.height.mas_equalTo(Size(98/2));
    }];
    
    
    _oneBtn = [UIButton ym_ButtonWithFrame:CGRectZero title:@"" backgroundColor:nil titleColor:COLOR_RGB_102 titleSize:Size(14) cornerRadius:Size(4) borderWidth:0.5 borderColor:COLOR_RGB_line];
    [_btnView addSubview:_oneBtn];
    [_oneBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.mas_offset(-Size(15));
        make.centerY.equalTo(_btnView);
        make.width.mas_equalTo(Size(160/2));
        make.height.mas_equalTo(Size(60/2));
    }];
    [_oneBtn addTarget:self action:@selector(doOneBtn:) forControlEvents:UIControlEventTouchUpInside];
    
//    _jobNameLab.text = @"产品经理";
//    _moneyLab.text = @"7~9K";
//    _dateLab.text = @"2017.08.26";
//    _logoImgV.image = [UIImage imageNamed:@"附近职位logo"];
//    _companyLab.text = @"shopee";
}

- (void)setList:(PositionList *)list{
    _list = list;
    
    _jobNameLab.text = list.job_name;//@"产品经理";
    _moneyLab.text = list.showRange;//@"7~9K";
    _dateLab.text = [[list.push_time componentsSeparatedByString:@" "] objectAtIndex:0];//@"2017.08.26";
    
    [_logoImgV sd_setImageWithURL:[NSURL URLWithString:list.imgUrl] placeholderImage:[UIImage imageNamed:@"前台默认站位图"]];
    _companyLab.text = list.company_name;
    
    self.score = list.total_star;
    
    self.tagLabArr[0].text = list.position_name;
    [self.tagLabArr[0] mas_updateConstraints:^(MASConstraintMaker *make) {
        make.width.mas_equalTo([self.tagLabArr[0].text ym_getStringWidthfont:[UIFont systemFontOfSize:Size(10)]] + Size(10));
    }];
    self.tagLabArr[1].text = [AppDelegateInstance educationNameWithID:list.education_level];
    [self.tagLabArr[1] mas_updateConstraints:^(MASConstraintMaker *make) {
        make.width.mas_equalTo([self.tagLabArr[1].text ym_getStringWidthfont:[UIFont systemFontOfSize:Size(10)]] + Size(10));
    }];
    self.tagLabArr[2].text = list.industry_class;
    [self.tagLabArr[2] mas_updateConstraints:^(MASConstraintMaker *make) {
        make.width.mas_equalTo([self.tagLabArr[2].text ym_getStringWidthfont:[UIFont systemFontOfSize:Size(10)]] + Size(10)).priorityHigh();
        make.right.mas_lessThanOrEqualTo(-Size(135/2));
    }];
    
    if ([list.status isEqualToString:@"0"]) {//招聘中
        [self.oneBtn setTitle:@"暂停" forState:UIControlStateNormal];
    }
    if ([list.status isEqualToString:@"1"]) {//未发布
        [self.oneBtn setTitle:@"发布" forState:UIControlStateNormal];
    }
    
    
    
}

- (void)setScore:(NSString *)score{
    _score = score;
    
    CGFloat s = score.floatValue;
    for (int i = 0; i<5; i++) {
        if (i<floorf(s)) {
            self.starImgVArr[i].image = [UIImage imageNamed:@"职位详情-收藏02"];
        }else{
            self.starImgVArr[i].image = [UIImage imageNamed:@"职位详情-收藏01"];
        }
    }
    if (s - floorf(s) == 0) {
        
    }else{
        [self.starImgVArr objectAtIndex:(NSUInteger )(ceilf(s)-1)].image = [UIImage imageNamed:@"半颗心"];
    }
    _scoreLab.text = score;//@"4.5分";
}

-(void)doOneBtn:(UIButton *)btn{
    BLOCK_EXEC(self.oneBtnBlock,btn);
}



-(NSMutableArray<UIImageView *> *)starImgVArr{
    if (!_starImgVArr) {
        _starImgVArr = [NSMutableArray array];
    }
    return _starImgVArr;
}
-(NSMutableArray<UILabel *> *)tagLabArr{
    if (!_tagLabArr) {
        _tagLabArr = [NSMutableArray array];
    }
    return _tagLabArr;
}


- (void)awakeFromNib {
    [super awakeFromNib];
    // Initialization code
}

- (void)setSelected:(BOOL)selected animated:(BOOL)animated {
    [super setSelected:selected animated:animated];

    // Configure the view for the selected state
}

@end
