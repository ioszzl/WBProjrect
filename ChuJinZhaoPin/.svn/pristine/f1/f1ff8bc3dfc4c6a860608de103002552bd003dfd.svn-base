//
//  ResumeSettingViewController.m
//  ChuJinZhaoPin
//
//  Created by eims on 2018/11/9.
//  Copyright © 2018 Monster. All rights reserved.
//

#import "ResumeSettingViewController.h"

@interface ResumeSettingViewController ()
@property (nonatomic, strong) UITextField *resumeNameTF;
@property (nonatomic, strong) UIButton *openBtn;
@property (nonatomic, strong) UIButton *defaultBtn;
@end

@implementation ResumeSettingViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    
    [self initUI];
    [self requestInitData];
}
-(void)initUI{
    self.title = @"设置";
    
    NSArray *arr = @[@"简历名称",@"公开程度",@"默认简历"];
    
    
    
    for (int i=0; i<arr.count; i++) {
        
        UIView * bgV = [UIView new];
        bgV.backgroundColor = RGBCOLOR(255, 255, 255);
        [self.view addSubview:bgV];
        [bgV mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.right.mas_equalTo(0);
            make.top.mas_offset(Size(10) + Size(60)*i);
            make.height.mas_equalTo(Size(60));
        }];
        
        UILabel *lab = [UILabel ym_labelWithFrame:CGRectZero font:FONT_SIZE_15 textColor:COLOR_RGB_51];
        lab.text = arr[i];
        [bgV addSubview:lab];
        [lab mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerY.equalTo(bgV);
            make.left.mas_offset(Size(15));
        }];
        
        switch (i) {
            case 0:
            {
                UITextField *nameTF = [UITextField new];
                nameTF.textAlignment = NSTextAlignmentRight;
                nameTF.textColor = COLOR_RGB_51;
                nameTF.font = FONT_SIZE_15;
                nameTF.enabled = NO;
                [bgV addSubview:nameTF];
                [nameTF mas_makeConstraints:^(MASConstraintMaker *make) {
                    make.centerY.equalTo(bgV);
                    make.right.mas_offset(-Size(15));
                }];
                self.resumeNameTF = nameTF;
            }
                break;
            case 1:
            {
                UIButton *openBtn = [UIButton buttonWithType:UIButtonTypeCustom];
                [openBtn setImage:[UIImage imageNamed:@"guan"] forState:UIControlStateNormal];
                [openBtn setImage:[UIImage imageNamed:@"open"] forState:UIControlStateSelected];
                openBtn.adjustsImageWhenHighlighted = NO;
                [bgV addSubview:openBtn];
                [openBtn mas_makeConstraints:^(MASConstraintMaker *make) {
                    make.centerY.equalTo(bgV);
                    make.right.mas_offset(-Size(15));
                    make.width.mas_equalTo(Size(60));
                    make.height.mas_equalTo(Size(56/2));
                }];
                [openBtn addTarget:self action:@selector(doOpenBtn:) forControlEvents:UIControlEventTouchUpInside];
                self.openBtn = openBtn;
            }
                break;
            case 2:
            {
                UIButton *defaultBtn = [UIButton buttonWithType:UIButtonTypeCustom];
                defaultBtn.adjustsImageWhenHighlighted = NO;
                [defaultBtn setImage:[UIImage imageNamed:@"guan"] forState:UIControlStateNormal];
                [defaultBtn setImage:[UIImage imageNamed:@"open"] forState:UIControlStateSelected];
                [bgV addSubview:defaultBtn];
                [defaultBtn mas_makeConstraints:^(MASConstraintMaker *make) {
                    make.centerY.equalTo(bgV);
                    make.right.mas_offset(-Size(15));
                    make.width.mas_equalTo(Size(60));
                    make.height.mas_equalTo(Size(56/2));
                }];
                [defaultBtn addTarget:self action:@selector(doDefaultBtn:) forControlEvents:UIControlEventTouchUpInside];
                self.defaultBtn = defaultBtn;
            }
                break;
            default:
                break;
        }
        
        if (i != arr.count-1) {
            UIView *line = [UIView new];
            line.backgroundColor = COLOR_RGB_line;
            [bgV addSubview:line];
            [line mas_makeConstraints:^(MASConstraintMaker *make) {
                make.left.mas_offset(Size(15));
                make.right.mas_offset(-Size(15));
                make.height.mas_equalTo(0.6);
                make.bottom.mas_offset(0);
            }];
        }
    }
    
    
}

#pragma mark - request
-(void)requestInitData{
    NSMutableDictionary *dataDic = [NSMutableDictionary dictionary];
    [dataDic setValue:self.resumeId forKey:@"resumeId"];
    
    NSMutableDictionary *paramDic = [NSMutableDictionary dictionary];
    [paramDic setValue:[dataDic mj_JSONString] forKey:@"data"];
    [paramDic setValue:AppDelegateInstance.token forKey:@"token"];
    
    [[RHNetAPIManager sharedManager]appGetResumeOpenTypeAndDefaultOPT:paramDic].start(^(id data, NSString *msg, NSInteger code, NSError *error) {
        if (data) {
            if ([data[@"data"] valueForKey:@"workJob"] == nil ||
                [[data[@"data"] valueForKey:@"workJob"] isMemberOfClass:[NSNull class]]) {
                self.resumeNameTF.text = @"";
            }else{
                self.resumeNameTF.text = [data[@"data"] valueForKey:@"workJob"];
            }
            
            if ([data[@"data"] valueForKey:@"defFileResumeId"] == self.resumeId) {
                self.defaultBtn.selected = YES;
            }else{
                self.defaultBtn.selected = NO;
            }
            
            if ([[data[@"data"] valueForKey:@"openType"] isEqualToString:@"0"]) {
                self.openBtn.selected = YES;
            }else{
                self.openBtn.selected = NO;
            }
        }
    });
}
#pragma mark - action
-(void)doOpenBtn:(UIButton *)btn{
    NSMutableDictionary *dataDic = [NSMutableDictionary dictionary];
    [dataDic setValue:self.resumeId forKey:@"resumeId"];
    [dataDic setValue:self.openBtn.selected ? @"1" : @"0" forKey:@"open_type"];
    
    NSMutableDictionary *paramDic = [NSMutableDictionary dictionary];
    [paramDic setValue:[dataDic mj_JSONString] forKey:@"data"];
    [paramDic setValue:AppDelegateInstance.token forKey:@"token"];
    
    [[RHNetAPIManager sharedManager]appSetOpenTypeOPT:paramDic].start(^(id data, NSString *msg, NSInteger code, NSError *error) {
        if (data) {
            [HUD showHUDError:nil title:msg];
            btn.selected = !btn.selected;
        }
    });
    
}
-(void)doDefaultBtn:(UIButton *)btn{
    NSMutableDictionary *dataDic = [NSMutableDictionary dictionary];
    [dataDic setValue:@"0" forKey:@"resumeType"];
    [dataDic setValue:self.defaultBtn.selected ? @"0" : @"1" forKey:@"open_type"];
    [dataDic setValue:self.resumeId forKey:@"resumeId"];
    
    NSMutableDictionary *paramDic = [NSMutableDictionary dictionary];
    [paramDic setValue:[dataDic mj_JSONString] forKey:@"data"];
    [paramDic setValue:AppDelegateInstance.token forKey:@"token"];
    
    [[RHNetAPIManager sharedManager]appSetDefResumeOPT:paramDic].start(^(id data, NSString *msg, NSInteger code, NSError *error) {
        if (data) {
            [HUD showHUDError:nil title:msg];
            btn.selected = !btn.selected;
        }
    });
    
}
/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
