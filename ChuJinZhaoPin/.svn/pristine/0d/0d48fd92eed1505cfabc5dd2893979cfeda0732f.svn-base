//
//  PositionRequireViewController.m
//  ChuJinZhaoPin
//
//  Created by eims on 2018/11/14.
//  Copyright © 2018 Monster. All rights reserved.
//

#import "PositionRequireViewController.h"
#import "YMTextView.h"
@interface PositionRequireViewController ()
@property (nonatomic, strong) YMTextView *contentTextV;
@end

@implementation PositionRequireViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    
    [self initUI];
}
-(void)initUI{
    self.title = @"任职要求";
    
    UIBarButtonItem *item = [[UIBarButtonItem alloc]initWithTitle:@"保存" style:UIBarButtonItemStyleDone target:self action:@selector(doSaveItem)];
    self.navigationItem.rightBarButtonItem = item;
    
    UIScrollView *scrollV = [UIScrollView new];
    [self.view addSubview:scrollV];
    [scrollV mas_makeConstraints:^(MASConstraintMaker *make) {
        make.edges.equalTo(self.view);
    }];
    
    UIView *contentV = [UIView new];
    contentV.backgroundColor = RGBCOLOR(255, 255, 255);
    [scrollV addSubview:contentV];
    [contentV mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.right.mas_offset(0);
        make.top.mas_offset(Size(10));
        make.width.mas_equalTo(kScreenWidth);
        make.height.mas_offset(Size(294));
    }];
    
    
    UILabel *contentLab = [UILabel ym_labelWithFrame:CGRectZero font:FONT_SIZE_15 textColor:COLOR_RGB_51];
    contentLab.text = @"任职要求";
    [contentV addSubview:contentLab];
    [contentLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.top.mas_offset(Size(15));
    }];
    _contentTextV = [YMTextView new];
    _contentTextV.placeholder = @"请填写任职要求";
    _contentTextV.font = FONT_SIZE_15;
    _contentTextV.textColor = COLOR_RGB_153;
    [contentV addSubview:_contentTextV];
    [_contentTextV mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_offset(Size(15));
        make.top.equalTo(contentLab.mas_bottom).mas_offset(Size(15));
        make.right.bottom.mas_offset(-Size(15));
        make.bottom.mas_offset(0);
    }];
    
    NSMutableAttributedString *attr = [NSString praseHtmlStr:self.postInitData.post.work_requirement];
    [attr addAttributes:@{NSForegroundColorAttributeName:COLOR_RGB_102,NSFontAttributeName:FONT_SIZE_15} range:NSMakeRange(0, attr.length)];
    self.contentTextV.attributedText = attr;
}

#pragma mark - action
-(void)doSaveItem{
    [self.view endEditing:YES];
    
    NSMutableDictionary *dataDic = [NSMutableDictionary dictionary];
    [dataDic setValue:self.postInitData.post.ID == 0 ? @"" : NSStringFromInteger(self.postInitData.post.ID) forKey:@"postId"];
    [dataDic setValue:self.postInitData.post.job_name forKey:@"jobName"];
    [dataDic setValue:NSStringFromInteger(self.postInitData.post.salary_range_id) forKey:@"salaryRangeId"];
    
    [dataDic setValue:[NSString attriToHtmlStrWithAttri:self.contentTextV.attributedText] forKey:@"workRequirement"];
    
    [dataDic setValue:@"1" forKey:@"status"];
    
    NSMutableDictionary *paramDic = [NSMutableDictionary dictionary];
    [paramDic setValue:[dataDic mj_JSONString] forKey:@"data"];
    [paramDic setValue:AppDelegateInstance.token forKey:@"token"];
    
    [[RHNetAPIManager sharedManager]appAddPostOPT:paramDic].start(^(id data, NSString *msg, NSInteger code, NSError *error) {
        if (data) {
            if (code == 5000) {//认证通过之后未交入驻押金前为试用期,试用期只能发布3个岗位,另一种情况为非试用期,但入驻押金少于1000,同样不能发布职位,会返回5000,这时,请跳转充值页面
                [HUD showHUDError:nil title:data[@"data"]];
                return ;
            }
            [HUD showHUDError:nil title:@"已保存"];
            [self.navigationController popViewControllerAnimated:YES];
        }
    });
}
/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
